<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boogieman - ë„ì„œ ìƒì„¸</title>
    <!-- Tailwind CSS ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì œê±°ë¨ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* CSS ë³€ìˆ˜: ë””ìì¸ ì‹œìŠ¤í…œ ìƒ‰ìƒ ì •ì˜ */
        :root {
            --color-primary-green: #4CAF50;
            --color-primary-green-dark: #388E3C;
            --color-primary-green-light: #E8F5E9;
            --color-secondary-yellow: #FFC107;
            --color-secondary-yellow-dark: #FFA000;
            --color-status-available-bg: #E8F5E9;
            --color-status-loan-bg: #FFF8E1;
            --color-status-overdue-bg: #FFEBEE;
            --color-text-dark: #212121;
            --color-text-muted: #757575;
            --color-gray-50: #F9FAFB;
            --color-gray-100: #F3F4F6;
            --color-gray-200: #E5E7EB;
            --border-radius-xl: 16px;
        }

        /* ê¸°ë³¸ ì„¤ì • */
        * {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            box-sizing: border-box;
        }

        body {
            background-color: var(--color-primary-green-light);
            line-height: 1.5;
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ (main layout:fragment="content") */
        .main-content-area {
            padding: 1rem; /* p-4 */
            min-height: 100vh;
        }
        @media (min-width: 768px) {
            .main-content-area {
                padding: 2rem; /* md:p-8 */
            }
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì¹´ë“œ */
        .book-detail-card {
            background-color: white;
            padding: 1.5rem; /* p-6 */
            border-radius: var(--border-radius-xl);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-lg */
        }
        @media (min-width: 768px) {
            .book-detail-card {
                padding: 2rem; /* md:p-8 */
            }
        }

        /* ìƒë‹¨ ìƒì„¸ ì •ë³´ + ë„ì„œ ì†Œê°œë¥¼ ë‹´ëŠ” ì»¨í…Œì´ë„ˆ (ìˆ˜ì •/ì¶”ê°€) */
        .top-detail-container {
            display: flex;
            flex-direction: column; /* ëª¨ë°”ì¼: ìˆ˜ì§ ì •ë ¬ */
            gap: 2rem; /* gap-8 */
            margin-bottom: 2rem; /* í•˜ë‹¨ ì†Œì¥ ì •ë³´ì™€ ë¶„ë¦¬ */
        }
        @media (min-width: 1024px) { /* ë°ìŠ¤í¬í†±: ì¢Œìš° ì •ë ¬ */
            .top-detail-container {
                flex-direction: row;
                gap: 2.5rem; /* md:gap-10 */
                align-items: flex-start;
            }
        }


        /* ë„ì„œ ìƒì„¸ ì •ë³´ ì„¹ì…˜ (ì¢Œì¸¡ ì¹¼ëŸ¼) */
        .book-detail-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* gap-6 */
            margin-bottom: 0; /* top-detail-containerì—ì„œ ë§ˆì§„ ê´€ë¦¬ */
        }
        @media (min-width: 768px) {
            .book-detail-section {
                flex-direction: row;
                gap: 2.5rem; /* md:gap-10 */
                align-items: center;
            }
        }
        @media (min-width: 1024px) {
            .book-detail-section {
                flex-basis: 45%; /* ì „ì²´ ê°€ë¡œ ë„ˆë¹„ì˜ 45% ì°¨ì§€ */
                max-width: 45%;
                flex-shrink: 0;
            }
        }

        /* ë„ì„œ ì»¤ë²„ */
        .book-cover {
            width: 100%;
            display: flex;
            justify-content: center;
            flex-shrink: 0;
            margin-bottom: 1rem; /* mb-4 */
        }
        .book-cover img {
            max-width: 160px; /* ê³ ì • ë„ˆë¹„ */
            height: 240px; /* ê³ ì • ë†’ì´ */
            object-fit: cover;
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); /* shadow-md */
        }
        @media (min-width: 768px) {
            .book-cover {
                width: 10rem; /* md:w-40 (160px) */
                display: block;
                margin-bottom: 0; /* md:mb-0 */
                margin-top: 0;
            }
        }

        /* ë„ì„œ ì œëª© */
        .book-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700;
            color: var(--color-text-dark);
            margin-top: 0; /* ì œëª© ìœ„ìª½ ì—¬ë°± ì œê±° */
            margin-bottom: 1rem; /* mb-4 */
        }

        /* ë„ì„œ ë©”íƒ€ ì •ë³´ */
        .book-info {
            flex: 1; /* flex-1 */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        @media (min-width: 768px) {
            .book-info {
                min-height: 240px;
            }
        }

        .book-meta-top {
            display: flex;
            flex-direction: column;
        }
        .book-meta {
            display: flex;
            flex-direction: column;
            gap: 0.75rem; /* space-y-3 */
            margin-bottom: 0;
            font-size: 1rem; /* text-base */
        }

        /* ìº¡ì²˜ ì´ë¯¸ì§€ì²˜ëŸ¼ ê¹”ë”í•˜ê²Œ ì •ë ¬í•˜ê¸° ìœ„í•œ CSS ìˆ˜ì • */
        .meta-item {
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }
        .meta-label {
            font-weight: 500;
            color: var(--color-text-dark);
            width: 5rem; /* ê³ ì • ë„ˆë¹„ë¡œ ë ˆì´ë¸” ì •ë ¬ */
            flex-shrink: 0;
            margin-right: 0.75rem; /* ë ˆì´ë¸”ê³¼ ë¶„ë¦¬ì„  ì‚¬ì´ ê°„ê²© í™•ëŒ€ */
        }
        .meta-separator {
            color: var(--color-text-dark);
            padding-right: 0.75rem; /* ë¶„ë¦¬ì„ ê³¼ ê°’ ì‚¬ì´ ê°„ê²© */
            flex-shrink: 0;
            font-weight: 500;
        }
        .meta-value {
            color: var(--color-text-dark);
            font-weight: 400;
            flex: 1;
        }
        /* /ìº¡ì²˜ ì´ë¯¸ì§€ ì •ë ¬ CSS ìˆ˜ì • ë */


        /* ë„ì„œ ì†Œê°œ ì„¹ì…˜ (ìš°ì¸¡ ì¹¼ëŸ¼) */
        .book-description {
            /* ê¸°ì¡´ ìˆ˜ì§ ë ˆì´ì•„ì›ƒìš© ë§ˆì§„/íŒ¨ë”©/êµ¬ë¶„ì„  ì œê±° */
            margin-top: 0; /* mt-8 ì œê±° */
            padding-top: 0; /* pt-6 ì œê±° */
            border-top: none; /* ìƒë‹¨ border ì œê±° */
            flex: 1; /* ë‚¨ì€ ê³µê°„ ì°¨ì§€ (ëª¨ë°”ì¼) */
        }

        @media (min-width: 1024px) {
            .book-description {
                flex-basis: 55%; /* ì „ì²´ ê°€ë¡œ ë„ˆë¹„ì˜ 55% ì°¨ì§€ */
                padding-left: 2.5rem; /* ì¢Œìš° ë‚´ìš©ë¬¼ ê°„ ê°„ê²© í™•ë³´ */
                border-left: 1px solid var(--color-gray-100); /* ì¢Œì¸¡ êµ¬ë¶„ì„  ì¶”ê°€ */
                align-self: flex-start;
            }
        }

        .book-description p {
            color: var(--color-text-dark);
            line-height: 1.625; /* leading-relaxed */
        }

        .section-title {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: var(--color-primary-green);
            margin-bottom: 1rem; /* mb-4 */
        }

        /* ì†Œì¥ ì •ë³´ ì„¹ì…˜ (ì—¬ì „íˆ í•˜ë‹¨ì— ìœ„ì¹˜) */
        .holding-info {
            margin-top: 2rem;
            padding-top: 1.5rem; /* pt-6 */
            border-top: 1px solid var(--color-gray-100);
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-container {
            overflow-x: auto;
        }
        .holdings-table {
            width: 100%;
            border-collapse: collapse;
        }
        .holdings-table thead {
            background-color: var(--color-gray-50);
        }
        .holdings-table th {
            padding: 0.75rem; /* p-3 */
            text-align: left;
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            color: #4B5563; /* text-gray-600 */
            border-bottom: 2px solid var(--color-primary-green-dark);
        }
        .holdings-table td {
            padding: 0.75rem; /* p-3 */
            font-size: 0.875rem; /* text-sm */
            color: var(--color-text-dark);
            border-bottom: 1px solid var(--color-gray-100);
        }
        .holdings-table tbody tr:hover {
            background-color: var(--color-gray-50); /* hover:bg-gray-50 */
            transition: background-color 0.15s ease-in-out;
        }

        /* ìƒíƒœ ë±ƒì§€ */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem; /* px-3 py-1 */
            font-size: 0.75rem; /* text-xs */
            font-weight: 500; /* font-medium */
            border-radius: 9999px; /* rounded-full */
        }
        /* ëŒ€ì¶œ ê°€ëŠ¥ (AVAILABLE) */
        .status-available-badge {
            background-color: var(--color-status-available-bg);
            color: var(--color-primary-green-dark);
        }

        /* ì˜ˆì•½ ì¤‘ (RESERVED) - ìƒˆë¡œìš´ ìƒíƒœ */
        .status-reserved-badge {
            background-color: var(--color-status-reserved-bg, #DBEAFE);
            color: var(--color-primary-blue-dark, #1D4ED8);
        }

        /* ëŒ€ì¶œ ì¤‘ (BORROWED) */
        .status-loan-badge {
            background-color: var(--color-status-loan-bg);
            color: var(--color-secondary-yellow-dark);
        }

        /* ì—°ì²´ ì¤‘ (OVERDUE) */
        .status-overdue-badge {
            background-color: var(--color-status-overdue-bg);
            color: #DC2626; /* red-600 */
        }

        /* ë¶„ì‹¤, íê¸° (LOST, DISCARDED) ë° ê¸°íƒ€ ìƒíƒœ */
        .status-etc-badge {
            background-color: var(--color-status-etc-bg);
            color: var(--color-text-muted);
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-action {
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.25rem 0.75rem; /* py-1 px-3 */
            transition: all 0.15s ease-in-out;
            white-space: nowrap; /* whitespace-nowrap */
            cursor: pointer;
            border: none;
        }
        .btn-reserve {
            background-color: var(--color-primary-green);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* shadow-md */
        }
        .btn-reserve:hover {
            background-color: var(--color-primary-green-dark);
        }
        .btn-cancel {
            background-color: var(--color-gray-200);
            color: var(--color-text-dark);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); /* shadow-sm */
        }
        .btn-cancel:hover {
            background-color: #D1D5DB; /* hover:bg-gray-300 */
        }
        .btn-disabled {
            color: var(--color-text-muted);
            padding: 0.25rem 0.75rem;
            display: inline-block;
        }
        .my-loan-text {
            font-size: 0.875rem;
            color: var(--color-primary-green-dark);
            font-weight: 600;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius-xl);
            width: 400px;
            max-width: 90%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .modal-title {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: var(--color-primary-green);
            margin-bottom: 1rem; /* mb-4 */
        }
        .modal-buttons {
            display: flex;
            justify-content: flex-end; /* justify-end */
            gap: 0.75rem; /* gap-3 */
            margin-top: 1.5rem; /* mt-6 */
        }

        /* ëª¨ë‹¬ ë²„íŠ¼ ì˜¤ë²„ë¼ì´ë“œ */
        .modal-buttons button {
            font-weight: 600; /* font-semibold */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.5rem 1rem; /* py-2 px-4 */
            transition: background-color 0.15s ease-in-out;
            border: none;
            cursor: pointer;
        }
        #modalActionBtn.btn-confirm-reserve {
            background-color: var(--color-primary-green);
            color: white;
        }
        #modalActionBtn.btn-confirm-reserve:hover {
            background-color: var(--color-primary-green-dark);
        }
        #modalActionBtn.btn-confirm-cancel {
            background-color: #EF4444; /* red-500 */
            color: white;
        }
        #modalActionBtn.btn-confirm-cancel:hover {
            background-color: #DC2626; /* red-600 */
        }
        .btn-modal-cancel {
            background-color: var(--color-gray-200);
            color: var(--color-text-dark);
        }
        .btn-modal-cancel:hover {
            background-color: #D1D5DB;
        }
        .complete-modal-btn {
            background-color: var(--color-primary-green);
            color: white;
        }
        .complete-modal-btn:hover {
            background-color: var(--color-primary-green-dark);
        }

        /* ë§ˆìŠ¤í‚¹ëœ ì‚¬ìš©ì ì •ë³´ */
        .loan-user-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-text-dark);
        }
        .loan-user-id {
            font-size: 0.75rem;
            color: var(--color-text-muted);
        }
        .reservation-count-display {
            font-weight: 500;
            color: var(--color-secondary-yellow-dark);
        }
    </style>
</head>
<body>

<main layout:fragment="content" th:with="activeMenu='books'" class="main-content-area no-search">
    <div class="main-content">
        <div class="book-detail-card">

            <div class="top-detail-container">
                <div class="book-detail-section">
                    <div class="book-cover">
                        <img id="bookThumbnail"
                             src=""
                             alt="ë„ì„œ ì»¤ë²„ ì´ë¯¸ì§€"
                             onerror="this.onerror=null; this.src=''"
                        />
                    </div>

                    <div class="book-info">
                        <div class="book-meta-top">
                            <h3 id="bookTitle" class="book-title">-</h3>

                            <div class="book-meta">
                                <div class="meta-item">
                                    <span class="meta-label">ì €ì</span>
                                    <span class="meta-separator">|</span>
                                    <span id="bookAuthors" class="meta-value">-</span>
                                </div>

                                <div class="meta-item">
                                    <span class="meta-label">ì¶œíŒì‚¬</span>
                                    <span class="meta-separator">|</span>
                                    <span id="bookPublisher" class="meta-value">-</span>
                                </div>

                                <div class="meta-item">
                                    <span class="meta-label">ì¶œíŒì¼</span>
                                    <span class="meta-separator">|</span>
                                    <span id="bookDatetime" class="meta-value">-</span>
                                </div>

                                <div class="meta-item">
                                    <span class="meta-label">ISBN</span>
                                    <span class="meta-separator">|</span>
                                    <span id="bookIsbn" class="meta-value">-</span>
                                </div>

                                <!--<div class="meta-item">
                                    <span class="meta-label">ë¶„ë¥˜</span>
                                    <span class="meta-separator">|</span>
                                    <span id="bookStatus" class="meta-value">-</span>
                                </div>-->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="book-description">
                    <h4 class="section-title">ë„ì„œ ì†Œê°œ</h4>
                    <p id="bookContents">-</p>
                </div>
            </div>

            <div class="holding-info">
                <h4 class="section-title">ì†Œì¥ ì •ë³´ (<span id="holdingsCount">ì´: 0ê¶Œ</span>)</h4>
                <div class="table-container">
                    <table class="holdings-table">
                        <thead>
                        <tr>
                            <th>ë“±ë¡ë²ˆí˜¸</th>
                            <th>ë„ì„œ ìƒíƒœ</th>
                            <th>ëŒ€ì¶œì(id)</th>
                            <th>ë°˜ë‚©ì˜ˆì •ì¼</th>
                            <th>ì˜ˆì•½ì ìˆ˜</th>
                            <th>ì„œë¹„ìŠ¤</th>
                        </tr>
                        </thead>
                        <tbody id="holdingsTbody"></tbody>
                    </table>
                </div>
            </div>
            <!-- /ì†Œì¥ ì •ë³´ ë -->
        </div>
    </div>

    <!-- ì˜ˆì•½/ì·¨ì†Œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="reserveModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="modalTitle">ë„ì„œ ì˜ˆì•½</h3>
            <p id="reserveModalText" style="color: var(--color-text-dark);">
                <!-- JSì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
            </p>
            <div class="modal-buttons">
                <button class="btn-modal-cancel" onclick="closeModal('reserveModal')">ì·¨ì†Œ</button>
                <button id="modalActionBtn" class="btn-confirm-reserve" onclick="handleModalAction()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ì™„ë£Œ ì•Œë¦¼ ëª¨ë‹¬ (ì˜ˆì•½ ì™„ë£Œ, ì·¨ì†Œ ì™„ë£Œ ë“±) -->
    <div id="completeModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="completeModalTitle">ì•Œë¦¼</h3>
            <p id="completeModalText" style="color: var(--color-text-dark);">
                <!-- JSì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
            </p>
            <div class="modal-buttons">
                <button class="complete-modal-btn" onclick="closeModal('completeModal')">í™•ì¸</button>
            </div>
        </div>
    </div>

    <input type="hidden" id="bookId" th:value="${bookId}"/>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const bookId = /*[[${bookId}]]*/ 0;

        document.addEventListener("DOMContentLoaded", () => {
            fetch(`/api/books/detail/${bookId}`)
                .then(res => res.json())
                .then(data => {
                    renderBookInfo(data);
                    renderHoldingsRows(data.holds, /* í˜„ì¬ ì‚¬ìš©ì: ì„œë²„ì—ì„œ ì£¼ë©´ ì¢‹ìŒ */ { id: 1, name: 'ê¹€ìˆ˜í˜„' });
                })
                .catch(err => console.error(err));
        });
        // ëª¨ë‹¬ ì—´ê¸°
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ëª¨ë‹¬ ì•¡ì…˜ ì²˜ë¦¬ (ì˜ˆì•½ ë˜ëŠ” ì˜ˆì•½ ì·¨ì†Œ)
        function handleModalAction() {
            const regNo = document.getElementById('reserveModalText').dataset.holdid;
            const action = currentModalAction;

            closeModal('reserveModal');

            if (action === 'reserve') {
                // ì˜ˆì•½ ì²˜ë¦¬ ë¡œì§
                document.getElementById('completeModalTitle').textContent = 'ì˜ˆì•½ ì™„ë£Œ';
                document.getElementById('completeModalText').innerHTML = `'${regNo}' ë„ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                openModal('completeModal');
            } else if (action === 'cancel') {
                // ì˜ˆì•½ ì·¨ì†Œ ì²˜ë¦¬ ë¡œì§
                document.getElementById('completeModalTitle').textContent = 'ì˜ˆì•½ ì·¨ì†Œ';
                document.getElementById('completeModalText').innerHTML = `'${regNo}' ë„ì„œ ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                openModal('completeModal');
            }
            // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì—¬ê¸°ì— ì„œë²„ API í˜¸ì¶œ ë¡œì§ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.
        }

        function renderBookInfo(book) {
            document.getElementById('bookTitle').textContent = book.title || '-';
            document.getElementById('bookThumbnail').src = book.thumbnail || '/mnt/data/cf149bcc-1e0f-4a96-8146-f4663b3ab48e.png';
            document.getElementById('bookAuthors').textContent = book.authors;
            document.getElementById('bookPublisher').textContent = book.publisher || '-';
            document.getElementById('bookDatetime').textContent = book.datetime ? book.datetime.substring(0,10) : '-';
            document.getElementById('bookIsbn').textContent = book.isbn || '-';
            // document.getElementById('bookStatus').textContent = book.status || '-';
            document.getElementById('bookContents').textContent = book.contents || '-';
            document.getElementById('holdingsCount').textContent = `ì´: ${book.holds.length || 0}ê¶Œ`;
        }

        // ìƒíƒœ í…ìŠ¤íŠ¸ì— ë”°ë¼ ìŠ¤íƒ€ì¼ì„ ë°˜í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        // BookHoldStatus Enumì˜ desc ê°’(í•œê¸€ ì„¤ëª…)ì„ ê¸°ì¤€ìœ¼ë¡œ í´ë˜ìŠ¤ë¥¼ ë§¤í•‘í•©ë‹ˆë‹¤.
        function getStatusBadge(status) {
            let className = '';

            switch (status) {
                case 'ëŒ€ì¶œê°€ëŠ¥':
                    className = 'status-available-badge';
                    break;
                case 'ì˜ˆì•½ì¤‘': // RESERVED
                    className = 'status-reserved-badge';
                    break;
                case 'ëŒ€ì¶œì¤‘': // BORROWED (ê¸°ì¡´ status-loan-badge ì‚¬ìš©)
                    className = 'status-loan-badge';
                    break;
                case 'ì—°ì²´ì¤‘': // OVERDUE
                    className = 'status-overdue-badge';
                    break;
                case 'ë¶„ì‹¤':   // LOST
                case 'íê¸°':   // DISCARDED
                case 'ìˆ˜ë¦¬': // Enumì— ì—†ìŒ
                    className = 'status-etc-badge';
                    break;
                default:
                    // Enumì— ì—†ëŠ” ê¸°íƒ€ ìƒíƒœ (ì˜ˆ: 'ìˆ˜ë¦¬' ë˜ëŠ” ì•Œ ìˆ˜ ì—†ëŠ” ê°’)ëŠ” etcë¡œ ì²˜ë¦¬
                    className = 'status-etc-badge';
            }
            return `<span class="status-badge ${className}">${status}</span>`;
        }

        function renderHoldingsRows(list, currentUser) {
            const tbody = document.getElementById('holdingsTbody');
            if (!tbody) return;

            const rowsHtml = list.map(h => {
                const status = h.status || '-';
                const statusBadgeHtml = getStatusBadge(h.statusDesc);

                const returnDateText = '<span style="color: var(--color-text-muted);">-</span>';

                const hasBorrower = !!h.loanUserId;
                const isBorrower = hasBorrower && currentUser && h.loanUserId === currentUser.id;

                // í˜„ì¬ ì‚¬ìš©ìê°€ ì˜ˆì•½í•œ ìƒíƒœì¸ì§€ ì²´í¬
                const isReservedByCurrentUser =
                    Array.isArray(h.reservationUserIds) &&
                    currentUser &&
                    h.reservationUserIds.includes(currentUser.id);

                const BUTTON_STYLE = {
                    reserve: "btn-action btn-reserve",
                    cancel: "btn-action btn-cancel",
                    disabled: "btn-disabled"
                };

                let actionsHtml = '';
                // let actionType = '';

                // ğŸ”¥ 1. í˜„ì¬ ì‚¬ìš©ìê°€ ì´ë¯¸ ì˜ˆì•½í•œ ê²½ìš° â†’ ì˜ˆì•½ì·¨ì†Œ ë²„íŠ¼ ìš°ì„  í‘œì‹œ
                if (isReservedByCurrentUser) {
                    actionsHtml =
                        `<button class="${BUTTON_STYLE.cancel}" data-action="cancel" data-holdid="${h.holdId}">ì˜ˆì•½ì·¨ì†Œ</button>`;
                    // actionType = 'cancel';

                } else if (hasBorrower) {
                    // ğŸ”¥ 2. ëŒ€ì¶œìê°€ ìˆëŠ” ê²½ìš°
                    if (isBorrower) {
                        // ë³¸ì¸ì´ ëŒ€ì¶œí•œ ê²½ìš°
                        actionsHtml = `<span class="my-loan-text">ë‚˜ì˜ ëŒ€ì¶œ</span>`;
                    } else {
                        // ë‹¤ë¥¸ ì‚¬ëŒì´ ëŒ€ì¶œí•œ ê²½ìš° â†’ ì˜ˆì•½ ê°€ëŠ¥
                        const canReserve = status === 'AVAILABLE' || status === 'BORROWED' || status === 'OVERDUE';
                        actionsHtml = canReserve
                            ? `<button class="${BUTTON_STYLE.reserve}" data-action="reserve" data-holdid="${h.holdId}">ì˜ˆì•½í•˜ê¸°</button>`
                            : `<span class="${BUTTON_STYLE.disabled}">-</span>`;
                        // if (canReserve) actionType = 'reserve';
                    }

                } else {
                    // ğŸ”¥ 3. ëŒ€ì¶œìê°€ ì—†ëŠ” ê²½ìš°
                    const canReserve = status === 'AVAILABLE';
                    actionsHtml = canReserve
                        ? `<button class="${BUTTON_STYLE.reserve}" data-action="reserve" data-holdid="${h.holdId}">ì˜ˆì•½í•˜ê¸°</button>`
                        : `<span class="${BUTTON_STYLE.disabled}">-</span>`;
                    // if (canReserve) actionType = 'reserve';
                }

                return `
                    <tr>
                        <td class="p-3" style="font-weight: 500;">${h.holdId}</td>
                        <td class="p-3">${statusBadgeHtml}</td>
                        <td class="p-3">${hasBorrower ? h.loanUserId : '-'}</td>
                        <td class="p-3" style="font-size: 0.875rem;">${returnDateText}</td>
                        <td class="p-3">
                            ${(h.reservationUserIds?.length || 0) > 0
                                            ? h.reservationUserIds.length + ' ëª…'
                                            : '-'}
                        </td>
                        <td class="p-3 holdings-row-actions" style="white-space: nowrap;">${actionsHtml}</td>
                    </tr>
                `;
            }).join("");

            tbody.innerHTML = rowsHtml;

            // ì´ë²¤íŠ¸ ë°”ì¸ë”© (ì˜ˆì•½ or ì˜ˆì•½ì·¨ì†Œ ë²„íŠ¼)
            tbody.querySelectorAll('button[data-action]').forEach(btn => {
                btn.addEventListener('click', e => {
                    const holdId = e.target.dataset.holdid;   // ğŸ”¥ holdId ì½ê¸° (ì˜ˆì•½ + ì˜ˆì•½ì·¨ì†Œ ê³µí†µ)
                    const action = e.target.dataset.action;   // reserve or cancel

                    currentModalAction = action;

                    const modalTitle = document.getElementById('modalTitle');
                    const modalText = document.getElementById('reserveModalText');
                    const modalActionBtn = document.getElementById('modalActionBtn');

                    // holdId ì „ë‹¬
                    modalText.dataset.holdid = holdId;

                    if (action === 'reserve') {
                        modalTitle.textContent = 'ë„ì„œ ì˜ˆì•½';
                        modalText.innerHTML =
                            `<span style="font-weight: 700; color: var(--color-primary-green-dark);">${holdId}</span> ë„ì„œë¥¼ ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                             <span style="font-size: 0.75rem; color: var(--color-text-muted);">ë„ì„œê°€ ë°˜ë‚©ë˜ë©´ ì•Œë¦¼ì„ ë“œë¦½ë‹ˆë‹¤.</span>`;
                        modalActionBtn.textContent = 'ì˜ˆì•½í•˜ê¸°';
                        modalActionBtn.className = 'btn-confirm-reserve';

                    } else if (action === 'cancel') {
                        modalTitle.textContent = 'ì˜ˆì•½ ì·¨ì†Œ';
                        modalText.innerHTML =
                            `ì •ë§ <span style="font-weight: 700; color: var(--color-primary-green-dark);">${holdId}</span> ë„ì„œ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
                        modalActionBtn.textContent = 'ì·¨ì†Œí•˜ê¸°';
                        modalActionBtn.className = 'btn-confirm-cancel';
                    }

                    openModal('reserveModal');
                });
            });

            // í…Œì´ë¸” row í˜¸ë²„ íš¨ê³¼ë¥¼ ìœ„í•´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (CSSë¡œ ì²˜ë¦¬í•˜ê¸° ì–´ë ¤ìš´ ë™ì  ì½˜í…ì¸ )
            tbody.querySelectorAll('.holdings-row').forEach(row => {
                row.addEventListener('mouseover', () => row.style.backgroundColor = 'var(--color-gray-50)');
                row.addEventListener('mouseout', () => row.style.backgroundColor = 'white');
            });
        }

        /*]]>*/
    </script>
</main>
</body>
</html>